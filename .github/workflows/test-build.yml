name: Test AppImage Build
on:
  workflow_dispatch:
    inputs:
      version_url:
        description: 'Full Antigravity tarball URL to test'
        required: true
        default: ''

jobs:
  test:
    runs-on: ubuntu-22.04
    steps:
      - uses: actions/checkout@v2
      - name: Install deps
        run: sudo apt-get update && sudo apt-get install -y libfuse2 imagemagick jq
      - name: Set test inputs
        run: |
          echo "INPUT_VERSION_URL=${{ github.event.inputs.version_url }}" >> $GITHUB_ENV
          echo "INPUT_VERSION_FILE=version" >> $GITHUB_ENV
          echo "INPUT_VERSION_ICON=antigravity.png" >> $GITHUB_ENV
          echo "INPUT_VERSION_BASH=cat" >> $GITHUB_ENV
      - name: Run build
        uses: valicm/appimage-bash@main
        with:
          version_url: ${{ github.event.inputs.version_url }}
          version_file: 'version'
          version_bash: 'cat'
          version_icon: 'antigravity.png'
      - name: Upload artifact
        if: ${{ env.APP_UPDATE_NEEDED == 'true' }}
        uses: actions/upload-artifact@v4
        with:
          name: Test-Antigravity.AppImage
          path: 'dist'
